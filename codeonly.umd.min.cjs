!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).codeonly={})}(this,(function(e){"use strict";e.env=null;class t extends EventTarget{constructor(){super(),this.browser=!1}#e=0;enterLoading(){this.#e++,1==this.#e&&this.dispatchEvent(new Event("loading"))}leaveLoading(){this.#e--,0==this.#e&&this.dispatchEvent(new Event("loaded"))}get loading(){return 0!=this.#e}async load(e){this.enterLoading();try{return await e()}finally{this.leaveLoading()}}}function n(t){e.env=t}class i{constructor(e){this.html=e}}class s{constructor(e){this.value=e}}let r=[],o=[],a=null;function l(){0!=o.length&&(null==a&&(a=document.createElement("style")),a.innerHTML+=o.join("\n"),o=[],a.parentNode||document.head.appendChild(a))}let d=[],h=!1;function c(t,n){t&&(0!=(n=n??0)&&(h=!0),d.push({callback:t,order:n}),1==d.length&&e.env.requestAnimationFrame((function(){let e=d;h&&(e.sort(((e,t)=>t.order-e.order)),h=!1),d=[];for(let t=e.length-1;t>=0;t--)e[t].callback()})))}class p{static compile(){return e.env.compileTemplate(...arguments)}}class u extends EventTarget{constructor(){super(),this.update=this.update.bind(this),this.invalidate=this.invalidate.bind(this)}static _compiledTemplate;static get compiledTemplate(){return this._compiledTemplate||(this._compiledTemplate=this.compileTemplate()),this._compiledTemplate}static compileTemplate(){return p.compile(this.template)}static get isSingleRoot(){return this.compiledTemplate.isSingleRoot}init(){this.#t||(this.#t=new this.constructor.compiledTemplate({model:this}))}#t;get dom(){return this.#t||this.init(),this.#t}get isSingleRoot(){return this.dom.isSingleRoot}get rootNode(){if(!this.isSingleRoot)throw new Error("rootNode property can't be used on multi-root template");return this.dom.rootNode}get rootNodes(){return this.dom.rootNodes}static nextFrameOrder=-100;invalidate(){this.#t&&(this.invalid||(this.invalid=!0,u.invalidate(this)))}validate(){this.invalid&&this.update()}static _invalidComponents=[];static invalidate(e){this._invalidComponents.push(e),1==this._invalidComponents.length&&c((()=>{for(let e=0;e<this._invalidComponents.length;e++)this._invalidComponents[e].validate();this._invalidComponents=[]}),u.nextFrameOrder)}update(){this.#t&&(this.invalid=!1,this.dom.update())}async load(t){this.#e++,1==this.#e&&(this.invalidate(),e.env.enterLoading(),this.dispatchEvent(new Event("loading")));try{return await t()}finally{this.#e--,0==this.#e&&(this.invalidate(),this.dispatchEvent(new Event("loaded")),e.env.leaveLoading())}}#e=0;get loading(){return 0!=this.#e}set loading(e){throw new Error("setting Component.loading not supported, use load() function")}render(e){this.dom.render(e)}destroy(){this.#t&&(this.#t.destroy(),this.#t=null)}onMount(){}onUnmount(){}#n=!1;setMounted(e){this.#t?.setMounted(e),this.#n=e,e?this.onMount():this.onUnmount()}mount(e){return"string"==typeof e&&(e=document.querySelector(e)),e.append(...this.rootNodes),this.setMounted(!0),this}unmount(){this.#t&&this.rootNodes.forEach((e=>e.remove())),this.setMounted(!1)}static template={}}class m extends Array{constructor(){super(...arguments)}#i=[];static from(){return new m(...arguments)}addListener(e){this.#i.push(e)}removeListener(e){let t=this.#i.indexOf(fn);t>=0&&this.#i.splice(t,1)}fire(e,t,n){0==t&&0==n||this.#i.forEach((i=>i(e,t,n)))}touch(e){e>=0&&e<this.length&&this.#i.forEach((t=>t(e,0,0)))}push(){let e=this.length;super.push(...arguments),this.fire(e,0,this.length-e)}pop(){let e=this.length;super.pop(),this.fire(this.length,e-this.length,0)}shift(){let e=this.length;super.shift(...arguments),this.fire(0,e-this.length,0)}unshift(){let e=this.length;super.unshift(...arguments),this.fire(0,0,this.length-e)}splice(e,t){e<0&&(e+=this.length),e>=this.length&&(t=0,e=this.length),void 0===t&&(t=this.length-e),t<0&&(t=0);let n=super.splice(...arguments);return this.fire(e,t,arguments.length>2?arguments.length-2:0),n}sort(){super.sort(...arguments),this.fire(0,this.length,this.length)}setAt(e,t){if(e<0||e>=this.length)throw new Error("Observable array index out of range");this[e]=t,this.fire(e,1,1)}get isObservable(){return!0}static from(e){return new m(...e)}}function f(e){let t,n="^",i=e.length;for(let r=0;r<i;r++){t=!0;let o=e[r];if("?"==o)n+="[^\\/]";else if("*"==o)n+="[^\\/]+";else if(":"==o){r++;let o=r;for(;r<i&&s(e[r]);)r++;let a=e.substring(o,r);if(0==a.length)throw new Error("syntax error in url pattern: expected id after ':'");let l="[^\\/]+";if("("==e[r]){r++,o=r;let t=0;for(;r<i;){if("("==e[r])t++;else if(")"==e[r]){if(0==t)break;t--}r++}if(r>=i)throw new Error("syntax error in url pattern: expected ')'");l=e.substring(o,r),r++}if(r<i&&"*"==e[r]||"+"==e[r]){let i=e[r];r++,"/"==e[r]?(n+=`(?<${a}>(?:${l}\\/)${i})`,r++):n+="*"==i?`(?<${a}>(?:${l}\\/)*(?:${l})?\\/?)`:`(?<${a}>(?:${l}\\/)*(?:${l})\\/?)`,t=!1}else n+=`(?<${a}>${l})`;r--}else"/"==o?(n+="\\"+o,r==e.length-1&&(n+="?")):".$^{}[]()|*+?\\/".indexOf(o)>=0?(n+="\\"+o,t="/"!=o):n+=o}return t&&(n+="\\/?"),n+="$",n;function s(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"==e||"$"==e}}function g(e){return null==e?"":(""+e).replace(/["'&<>]/g,(function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;"}}))}function y(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}function v(e){return e instanceof Function&&!!e.prototype&&!!e.prototype.constructor}let w=/^[a-zA-Z$][a-zA-Z0-9_$]*$/;function b(e){return e.match(w)?`.${e}`:`[${JSON.stringify(e)}]`}function $(e,t){e.loading?e.addEventListener("loaded",t,{once:!0}):t()}class x{static get(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}}static set(e){e?window.scrollTo(e.left,e.top):window.scrollTo(0,0)}}function N(){let e=[],t="";function n(...n){for(let i=0;i<n.length;i++){let s=n[i];s.lines?e.push(...s.lines.map((e=>t+e))):Array.isArray(s)?e.push(...s.filter((e=>null!=e)).map((e=>t+e))):e.push(...s.split("\n").map((e=>t+e)))}}function i(){t+="  "}function s(){t=t.substring(2)}return{append:n,enterCollapsibleBlock:function(...e){let t={pos:this.lines.length};return this.append(e),t.headerLineCount=this.lines.length-t.pos,t},leaveCollapsibleBlock:function(e,...t){this.lines.length==e.pos+e.headerLineCount?this.lines.splice(e.pos,e.headerLineCount):this.append(t)},indent:i,unindent:s,braced:function(e){n("{"),i(),e(this),s(),n("}")},toString:function(){return e.join("\n")+"\n"},lines:e,get isEmpty(){return 0==e.length}}}class E{constructor(){this.code=N(),this.code.closure=this,this.functions=[],this.locals=[],this.prologs=[],this.epilogs=[]}get isEmpty(){return this.code.isEmpty&&0==this.locals.length&&this.functions.every((e=>e.code.isEmpty))&&this.prologs.every((e=>e.isEmpty))&&this.epilogs.every((e=>e.isEmpty))}addProlog(){let e=N();return this.prologs.push(e),e}addEpilog(){let e=N();return this.epilogs.push(e),e}addLocal(e,t){this.locals.push({name:e,init:t})}addFunction(e,t){t||(t=[]);let n={name:e,args:t,code:new E};return this.functions.push(n),n.code}getFunction(e){return this.functions.find((t=>t.name==e))?.code}toString(){let e=N();return this.appendTo(e),e.toString()}appendTo(e){this.locals.length>0&&e.append(`let ${this.locals.map((e=>e.init?`${e.name} = ${e.init}`:e.name)).join(", ")};`);for(let t of this.prologs)e.append(t);e.append(this.code);for(let t of this.functions)e.append(`function ${t.name}(${t.args.join(", ")})`),e.append("{"),e.indent(),t.code.appendTo(e),e.unindent(),e.append("}");for(let t of this.epilogs)e.append(t)}}class S{static rawText(e){return e instanceof i?e.html:g(e)}static renderToString(e){let t="";return e({write:function(e){t+=e}}),t}static renderComponentToString(e){let t="";return e.render({write:function(e){t+=e}}),t}static rawStyle(e){let t;return t=e instanceof i?e.html:g(e),t=t.trim(),t.endsWith(";")||(t+=";"),t}static rawNamedStyle(e,t){if(!t)return"";let n;return n=t instanceof i?t.html:g(t),n=n.trim(),n+=";",`${e}:${n}`}static createTextNode(e){if(e instanceof i){let t=document.createElement("SPAN");return t.innerHTML=e.html,t}return document.createTextNode(e)}static setElementAttribute(e,t,n){void 0===n?e.removeAttribute(t):e.setAttribute(t,n)}static setElementText(e,t){t instanceof i?e.innerHTML=t.html:e.innerText=t}static setNodeText(e,t){if(t instanceof i){if(1==e.nodeType)return e.innerHTML=t.html,e;let n=document.createElement("SPAN");return n.innerHTML=t.html,e.replaceWith(n),n}{if(3==e.nodeType)return e.nodeValue=t,e;let n=document.createTextNode(t);return e.replaceWith(n),n}}static setNodeClass(e,t,n){n?e.classList.add(t):e.classList.remove(t)}static setNodeStyle(e,t,n){null==n?e.style.removeProperty(t):e.style[t]=n}static setNodeDisplay(e,t,n){if(!0!==t){if(!1===t||null==t){let t=e.style.display;return"none"!=e.style.display&&(e.style.display="none"),t??null}if("string"==typeof t){let n=e.style.display;return e.style.display!=t&&(e.style.display=t),n??null}}else null===n?e.style.removeProperty("display"):void 0!==n&&e.style.display!=n&&(e.style.display=n)}static replaceMany(e,t){if(e?.[0]?.parentNode){e[0].replaceWith(...t);for(let t=1;t<e.length;t++)e[t].remove()}}static addEventListener(e,t,n,i){function s(t){return i(e(),t)}return t.addEventListener(n,s),function(){t.removeEventListener(n,s)}}}class L{static plugins=[];static register(e){this.plugins.push(e)}static transform(e){for(let t of this.plugins)t.transform&&(e=t.transform(e));return e}static transformGroup(e){for(let t of this.plugins)t.transformGroup?.(e)}}class C{constructor(t,n){if(Array.isArray(t)&&(t={$:t}),t._&&!t.type&&(t.type=t._,delete t._),v(t=L.transform(t))&&(t={type:t}),this.template=t,v(t.type))t.type.integrate?this.kind="integrated":this.kind="component";else if("string"==typeof t)this.kind="text";else if(t instanceof i){if(this.kind="html",this.html=t.html,e.env.document){let n=e.env.document.createElement("div");n.innerHTML=t.html,this.nodes=[...n.childNodes],this.nodes.forEach((e=>e.remove()))}}else t instanceof Function?this.kind="dynamic_text":"comment"===t.type?this.kind="comment":void 0===t.type?this.kind="fragment":this.kind="element";if("integrated"===this.kind&&(t.$&&!t.content&&(t.content=t.$,delete t.$),this.integrated=this.template.type.integrate(this.template,n)),"element"==this.kind&&t.$&&!t.text&&("string"==typeof t.$||t.$ instanceof i)&&(t.text=t.$,delete t.$),"element"==this.kind||"fragment"==this.kind)t.$&&!t.childNodes&&(t.childNodes=t.$,delete t.$),t.childNodes?(Array.isArray(t.childNodes)?t.childNodes=t.childNodes.flat():t.childNodes=[t.childNodes],t.childNodes.forEach((e=>{e._&&!e.type&&(e.type=e._,delete e._)})),L.transformGroup(t.childNodes),this.childNodes=this.template.childNodes.map((e=>new C(e,n)))):this.childNodes=[];else if(this.isComponent)t.$&&!t.content&&(t.content=t.$,delete t.$);else if(t.childNodes)throw new Error("childNodes only supported on element and fragment nodes")}get isSingleRoot(){return this.isFragment?1==this.childNodes.length&&this.childNodes[0].isSingleRoot:this.isComponent?this.template.type.isSingleRoot:this.isIntegrated?this.integrated.isSingleRoot:"html"!=this.kind||1==this.nodes.length}get isComponent(){return"component"===this.kind}get isFragment(){return"fragment"===this.kind}get isIntegrated(){return"integrated"===this.kind}*enumLocalNodes(){if(this.isFragment||(yield this),this.childNodes)for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumLocalNodes()}spreadChildDomNodes(){return Array.from(function*(e){for(let t=0;t<e.childNodes.length;t++)yield e.childNodes[t].spreadDomNodes()}(this)).filter((e=>e.length>0)).join(", ")}spreadDomNodes(){return Array.from(this.enumAllNodes()).join(", ")}*enumAllNodes(){switch(this.kind){case"fragment":for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumAllNodes();break;case"component":case"integrated":this.isSingleRoot?yield`${this.name}.rootNode`:yield`...${this.name}.rootNodes`;break;case"html":this.nodes.length>0&&(this.nodes.length>1?yield`...${this.name}`:yield`${this.name}`);break;default:yield this.name}}}class T{static integrate(e,t){let n=null;e.content&&"object"==typeof e.content&&(n=e.content,delete e.content);let i={isSingleRoot:!1,data:{ownsContent:e.ownsContent??!0,content:e.content},nodes:[n?new C(n,t):null,e.placeholder?new C(e.placeholder,t):null]};return delete e.content,delete e.placeholder,delete e.ownsContent,i}static transform(e){return e instanceof Function&&!v(e)?{type:T,content:e}:("embed-slot"==e.type&&(e.type=T),e)}static transformGroup(e){for(let t=1;t<e.length;t++)void 0!==e[t].else&&(e[t-1]=T.transform(e[t-1]),e[t-1].type!==T||e[t-1].placeholder||(delete e[t].else,e[t-1].placeholder=e[t],e.splice(t,1),t--))}#s;#r;#o;#a;#l;#d;#h;#c;constructor(t){this.#s=t.context,this.#h=t.nodes[1],this.#a=e.env.document?.createTextNode(""),this.#d=e.env.document?.createTextNode(""),this.#l=[],this.#p=t.data.ownsContent??!0,t.nodes[0]?this.content=t.nodes[0]():this.content=t.data.content}get rootNodes(){return[this.#a,...this.#l,this.#d]}get isSingleRoot(){return!1}#p=!0;get ownsContent(){return this.#p}set ownsContent(e){this.#p=e}get content(){return this.#r}set content(e){this.#r=e,this.#r instanceof Function?this.replaceContent(this.#r.call(this.#s.model,this.#s.model,this.#s)):this.replaceContent(this.#r)}update(){this.#r instanceof Function&&this.replaceContent(this.#r.call(this.#s.model,this.#s.model,this.#s))}bind(){this.#c&&this.#o?.bind?.()}unbind(){this.#c&&this.#o?.unbind?.()}get isAttached(){}get#u(){return null!=this.#a?.parentNode}#n;setMounted(e){this.#n=e,this.#o?.setMounted?.(e)}replaceContent(t){if(t!=this.#o&&(t||!this.#c)){if(this.#u){let e=this.#a.nextSibling;for(;e!=this.#d;){let t=e.nextSibling;e.remove(),e=t}}if(this.#n&&this.#o?.setMounted?.(!1),this.#l=[],this.#p&&this.#o?.destroy?.(),this.#o=t,this.#c=!1,t)if(void 0!==t.rootNodes)this.#l=t.rootNodes;else if(Array.isArray(t))this.#l=t;else if(void 0!==e.env.Node&&t instanceof e.env.Node)this.#l=[t];else if(t instanceof i){let n=e.env.document.createElement("span");n.innerHTML=t.html,this.#l=[...n.childNodes]}else if("string"==typeof t)this.#l=[e.env.document.createTextNode(t)];else{if(!t.render)throw new Error("Embed slot requires component, array of HTML nodes or a single HTML node");this.#l=[]}else this.#h&&(this.#o=this.#h(this.#s),this.#c=!0,this.#l=this.#o.rootNodes);this.#u&&this.#d.before(...this.#l),this.#n&&this.#o?.setMounted?.(!0)}}destroy(){this.#p&&this.#o?.destroy?.()}render(e){this.#o&&this.#o.render?.(e)}}L.register(T);class _{constructor(){}#m=new Map;add(e,t){let n=this.#m.get(e);n?n.push(t):this.#m.set(e,[t])}delete(e,t){let n=this.#m.get(e);if(n){let e=n.indexOf(t);if(e>=0)return void n.splice(e,1)}throw new Error("key/value pair not found")}consume(e){let t=this.#m.get(e);if(t&&0!=t.length)return t.shift()}has(e){return this.#m.has(e)}}class O{static integrate(e,t){let n,i={itemConstructor:t.compileTemplate(e.template),template:{items:e.items,condition:e.condition,itemKey:e.itemKey}};return e.empty&&(n=[new C(e.empty,t)]),delete e.template,delete e.items,delete e.condition,delete e.itemKey,delete e.empty,{isSingleRoot:!1,data:i,nodes:n}}static transform(e){if(void 0===e.foreach)return e;let t;return e.foreach instanceof Function||Array.isArray(e.foreach)?(t={type:O,template:e,items:e.foreach},delete e.foreach):(t=Object.assign({},e.foreach,{type:O,template:e}),delete e.foreach),t}static transformGroup(e){for(let t=1;t<e.length;t++)void 0!==e[t].else&&(void 0!==e[t-1].foreach&&(e[t-1]=O.transform(e[t-1])),e[t-1].type!==O||e[t-1].else||(delete e[t].else,e[t-1].empty=e[t],e.splice(t,1),t--))}constructor(t){this.itemConstructor=t.data.itemConstructor,this.outer=t.context,this.items=t.data.template.items,this.condition=t.data.template.condition,this.itemKey=t.data.template.itemKey,this.emptyConstructor=t.nodes.length?t.nodes[0]:null,this.itemDoms=[],this.#a=e.env.document?.createComment(" enter foreach block "),this.#d=e.env.document?.createComment(" leave foreach block "),this.itemConstructor.isSingleRoot?(this.#f=this.#g,this.#y=this.#v,this.#w=this.#b,this.#$=this.#x):(this.#f=this.#N,this.#y=this.#E,this.#w=this.#S,this.#$=this.#L)}onObservableUpdate(e,t,n){let i={outer:this.outer};if(0==n&&0==t){let t=this.observableItems[e],n=[t],s=null;this.itemKey&&(i.model=t,s=[this.itemKey.call(t,t,i)]),this.#C(n,s,e,0,1)}else{let s=null,r=this.observableItems.slice(e,e+n);this.itemKey&&(s=r.map((e=>(i.model=e,this.itemKey.call(e,e,i))))),n&&t?this.#T(e,t,r,s):0!=t?this.#y(e,t):0!=n&&this.#f(r,s,e,0,n),this.#_()}}get rootNodes(){let e=this.emptyDom?this.emptyDom.rootNodes:[];if(this.itemConstructor.isSingleRoot)return[this.#a,...this.itemDoms.map((e=>e.rootNode)),...e,this.#d];{let t=[this.#a];for(let e=0;e<this.itemDoms.length;e++)t.push(...this.itemDoms[e].rootNodes);return t.push(...e),t.push(this.#d),t}}#a;#d;#n=!1;setMounted(e){this.#n=e,A(this.itemDoms,e)}update(){let e;e=this.items instanceof Function?this.items.call(this.outer.model,this.outer.model,this.outer):this.items,e=e??[],null!=this.observableItems&&this.observableItems!=e&&this.observableItems.removeListener(this._onObservableUpdate),Array.isArray(e)&&e.isObservable&&this.observableItems!=e&&(this._onObservableUpdate=this.onObservableUpdate.bind(this),this.observableItems=e,this.observableItems.addListener(this._onObservableUpdate),this.#y(0,this.itemDoms.length),this.itemsLoaded=!1);let t={outer:this.outer},n=null;if(this.observableItems||this.condition&&(e=e.filter((e=>(t.model=e,this.condition.call(e,e,t))))),this.itemKey&&(n=e.map((e=>(t.model=e,this.itemKey.call(e,e,t))))),!this.itemsLoaded)return this.itemsLoaded=!0,this.#f(e,n,0,0,e.length),void this.#_();this.observableItems||this.#T(0,this.itemDoms.length,e,n)}render(e){e.write("\x3c!-- enter foreach block --\x3e");for(let t=0;t<this.itemDoms.length;t++)this.itemDoms[t].render(e);e.write("\x3c!-- leave foreach block --\x3e")}#T(e,t,n,i){let s,r,o=e+t;if(s=0==e&&t==this.itemDoms.length?this.itemDoms:this.itemDoms.slice(e,o),r=i?function(e,t){let n=Math.min(e.length,t.length),i=Math.max(e.length,t.length),s=0;for(;s<n&&e[s]==t[s];)s++;if(s==i)return[];if(s==e.length)return[{op:"insert",index:e.length,count:t.length-e.length}];let r=0;for(;r<n-s&&e[e.length-r-1]==t[t.length-r-1];)r++;if(r==e.length)return[{op:"insert",index:0,count:t.length-e.length}];if(s+r==e.length)return[{op:"insert",index:s,count:t.length-e.length}];if(s+r==t.length)return[{op:"delete",index:s,count:e.length-t.length}];let o=e.length-r,a=t.length-r,l=f(t,s,a),d=null,h=[],c=s,p=s;for(;c<a;){for(;c<a&&e[p]==t[c];)l.delete(t[c],c),c++,p++;let n=c,i=p;for(;p<o&&!l.has(e[p]);)p++;if(p>i)h.push({op:"delete",index:n,count:p-i});else{for(d||(d=f(e,c,o));c<a&&!d.has(t[c]);)l.delete(t[c],c),c++;if(!(c>n))break;h.push({op:"insert",index:n,count:c-n})}}if(c==a)return h;let u=0,m=new _;for(;p<o;){let t=p;for(;p<o&&!l.has(e[p]);)p++;if(p>t)h.push({op:"delete",index:c,count:p-t});else{for(;p<o&&void 0!==l.consume(e[p]);)m.add(e[p],u++),p++;p>t&&h.push({op:"store",index:c,count:p-t})}}for(;c<a;){let e=c;for(;c<a&&!m.has(t[c]);)c++;if(c>e){h.push({op:"insert",index:e,count:c-e});continue}let n={op:"restore",index:c,count:0};for(h.push(n);c<a;){let e=m.consume(t[c]);if(void 0===e)break;0==n.count?(n.storeIndex=e,n.count=1):n.storeIndex+n.count==e?n.count++:(n={op:"restore",index:c,storeIndex:e,count:1},h.push(n)),c++}}return h;function f(e,t,n){let i=new _;for(let s=t;s<n;s++)i.add(e[s],s);return i}}(s.map((e=>e.context.key)),i):n.length>s.length?[{op:"insert",index:s.length,count:n.length-s.length}]:n.length<s.length?[{op:"delete",index:n.length,count:s.length-n.length}]:[],0==r.length)return void this.#C(n,i,e,0,t);let a=[],l=[],d={insert:function(t){h+=t.count;let s=Math.min(l.length,t.count);s&&(this.#w(t.index+e,l.splice(0,s)),this.#C(n,i,t.index+e,t.index,s)),s<t.count&&this.#f(n,i,t.index+e+s,t.index+s,t.count-s)},delete:function(t){l.push(...this.#$(t.index+e,t.count))},store:function(t){a.push(...this.#$(t.index+e,t.count))},restore:function(t){h+=t.count,this.#w(t.index+e,a.slice(t.storeIndex,t.storeIndex+t.count)),this.#C(n,i,t.index+e,t.index,t.count)}},h=0;for(let t of r)t.index>h&&(this.#C(n,i,e+h,h,t.index-h),h=t.index),d[t.op].call(this,t);h<n.length&&this.#C(n,i,e+h,h,n.length-h),this.#n&&A(l,!1),k(l),this.#_()}bind(){this.emptyDom?.bind?.()}unbind(){this.emptyDom?.unbind?.()}destroy(){null!=this.observableItems&&(this.observableItems.removeListener(this._onObservableUpdate),this.observableItems=null),k(this.itemDoms),this.itemDoms=null}#_(){if(0==this.itemDoms.length)!this.emptyDom&&this.emptyConstructor&&(this.emptyDom=this.emptyConstructor(),this.#u&&this.#d.before(...this.emptyDom.rootNodes),this.#n&&this.emptyDom.setMounted(!0)),this.emptyDom&&this.emptyDom.update();else if(this.emptyDom){if(this.#u)for(var e of this.emptyDom.rootNodes)e.remove();this.#n&&this.emptyDome.setMounted(!1),this.emptyDom.destroy(),this.emptyDom=null}}#f;#w;#y;#$;get#u(){return null!=this.#d?.parentNode}#N(e,t,n,i,s){let r=[];for(let o=0;o<s;o++){let s={outer:this.outer,model:e[i+o],key:t?.[i+o],index:n+o};r.push(this.itemConstructor(s))}this.#S(n,r),this.#n&&A(r,!0)}#S(e,t){if(this.itemDoms.splice(e,0,...t),this.#u){let n,i=[];t.forEach((e=>i.push(...e.rootNodes))),n=e+t.length<this.itemDoms.length?this.itemDoms[e+t.length].rootNodes[0]:this.#d,n.before(...i)}}#E(e,t){let n=this.#L(e,t);this.#n&&A(n,!1),k(n)}#L(e,t){if(this.#u)for(let n=0;n<t;n++){let t=this.itemDoms[e+n].rootNodes;for(let e=0;e<t.length;e++)t[e].remove()}return this.itemDoms.splice(e,t)}#g(e,t,n,i,s){let r=[];for(let o=0;o<s;o++){let s={outer:this.outer,model:e[i+o],key:t?.[i+o],index:n+o};r.push(this.itemConstructor(s))}this.#b(n,r),this.#n&&A(r,!0)}#b(e,t){if(this.itemDoms.splice(e,0,...t),this.#u){let n,i=t.map((e=>e.rootNode));n=e+t.length<this.itemDoms.length?this.itemDoms[e+t.length].rootNode:this.#d,n.before(...i)}}#v(e,t){let n=this.#x(e,t);this.#n&&A(n,!1),k(n)}#x(e,t){if(this.#u)for(let n=0;n<t;n++)this.itemDoms[e+n].rootNode.remove();return this.itemDoms.splice(e,t)}#C(e,t,n,i,s){for(let r=0;r<s;r++){let s=this.itemDoms[n+r];s.context.key=t?.[i+r],s.context.index=n+r,s.context.model=e[i+r],s.rebind(),s.update()}}}function k(e){for(let t=e.length-1;t>=0;t--)e[t].destroy()}function A(e,t){for(let n=e.length-1;n>=0;n--)e[n].setMounted(t)}function M(t){let n=function(){let n=e.env.document?.createComment(t);return{get rootNode(){return n},get rootNodes(){return[n]},get isSingleRoot(){return!0},setMounted(e){},destroy(){},update(){},render(e){e.write(`\x3c!--${g(t)}--\x3e`)}}};return n.isSingleRoot=!0,n}L.register(O);class D{static integrate(e,t){let n=[],i=[],s=!1,r=!0;for(let o=0;o<e.branches.length;o++){let a=e.branches[o],l={};if(n.push(l),a.condition instanceof Function?(l.condition=a.condition,s=!1):void 0!==a.condition?(l.condition=()=>a.condition,s=!!a.condition):(l.condition=()=>!0,s=!0),void 0!==a.template){let e=new C(a.template,t);e.isSingleRoot||(r=!1),l.nodeIndex=i.length,i.push(e)}}return delete e.branches,s||n.push({condition:()=>!0}),{isSingleRoot:r,nodes:i,data:n}}static transform(e){if(void 0===e.if)return e;let t={type:D,branches:[{template:e,condition:e.if}]};return delete e.if,t}static transformGroup(e){let t=null;for(let n=0;n<e.length;n++){let i=e[n];if(i.if)t={type:D,branches:[{condition:i.if,template:i}]},delete i.if,e.splice(n,1,t);else if(i.elseif){if(!t)throw new Error("template has 'elseif' without a preceeding condition");t.branches.push({condition:i.elseif,template:i}),delete i.elseif,e.splice(n,1),n--}else if(void 0!==i.else){if(!t)throw new Error("template has 'else' without a preceeding condition");t.branches.push({condition:!0,template:i}),delete i.else,t=null,e.splice(n,1),n--}else t=null}}constructor(e){this.branches=e.data,this.branch_constructors=[],this.context=e.context;for(let t of this.branches)void 0!==t.nodeIndex?this.branch_constructors.push(e.nodes[t.nodeIndex]):this.branch_constructors.push(M(" IfBlock placeholder "));this.activeBranchIndex=-1,this.activeBranch=M(" IfBlock placeholder ")()}destroy(){this.activeBranch.destroy()}update(){this.switchActiveBranch(),this.activeBranch.update()}render(e){this.activeBranch.render(e)}unbind(){this.activeBranch.unbind?.()}bind(){this.activeBranch.bind?.()}switchActiveBranch(e){let t=this.resolveActiveBranch();if(t!=this.activeBranchIndex){let e=this.activeBranch;this.activeBranchIndex=t,this.activeBranch=this.branch_constructors[t](),S.replaceMany(e.rootNodes,this.activeBranch.rootNodes),this.#n&&(e.setMounted(!1),this.activeBranch.setMounted(!0)),e.destroy()}}resolveActiveBranch(){for(let e=0;e<this.branches.length;e++)if(this.branches[e].condition.call(this.context.model,this.context.model,this.context))return e;throw new Error("internal error, IfBlock didn't resolve to a branch")}#n=!1;setMounted(e){this.#n=e,this.activeBranch.setMounted(e)}get rootNodes(){return this.activeBranch.rootNodes}get rootNode(){return this.activeBranch.rootNode}}L.register(D);let F=1;function R(t,n){(n=n??{}).compileTemplate=R;let r=function(e,t){let n=1,r=1,o=[],a=null,l=new C(e,t),d=new Map,h=function e(h,c){let p,u={emit_text_node:function(e){v(e),m.create.append(`${e.name} = document.createTextNode(${JSON.stringify(e.template)});`)},emit_html_node:function(e){0!=e.nodes.length&&(v(e),1==e.nodes.length?(m.create.append(`${e.name} = refs[${o.length}].cloneNode(true);`),o.push(e.nodes[0])):(m.create.append(`${e.name} = refs[${o.length}].map(x => x.cloneNode(true));`),o.push(e.nodes)))},emit_dynamic_text_node:function(e){v(e);let t="p"+r++;m.addLocal(t),m.create.append(`${e.name} = helpers.createTextNode("");`),w(),m.update.append(`temp = ${S(o.length)};`),m.update.append(`if (temp !== ${t})`),m.update.append(`  ${e.name} = helpers.setNodeText(${e.name}, ${t} = ${S(o.length)});`),o.push(e.template)},emit_comment_node:function(e){if(v(e),e.template.text instanceof Function){let t="p"+r++;m.addLocal(t),m.create.append(`${e.name} = document.createComment("");`),w(),m.update.append(`temp = ${S(o.length)};`),m.update.append(`if (temp !== ${t})`),m.update.append(`  ${e.name}.nodeValue = ${t} = temp;`),o.push(e.template.text)}else m.create.append(`${e.name} = document.createComment(${JSON.stringify(e.template.text)});`)},emit_fragment_node:function(e){x(e)},emit_element_node:function(e){let t=m.current_xmlns,n=e.template.xmlns;void 0===n&&"svg"==e.template.type&&(n="http://www.w3.org/2000/svg"),null==n&&(n=m.current_xmlns),v(e),n?(m.current_xmlns=n,m.create.append(`${e.name} = document.createElementNS(${JSON.stringify(n)}, ${JSON.stringify(e.template.type)});`)):m.create.append(`${e.name} = document.createElement(${JSON.stringify(e.template.type)});`),m.destroy.append(`${e.name} = null;`);for(let t of Object.keys(e.template))if(!N(e,t))if("id"!=t)if("class"!=t)if(t.startsWith("class_")){let n=y(t.substring(6));L(e.template[t],(t=>`helpers.setNodeClass(${e.name}, ${JSON.stringify(n)}, ${t})`))}else if("style"!=t){if(t.startsWith("style_")){let n=y(t.substring(6));L(e.template[t],(t=>`helpers.setNodeStyle(${e.name}, ${JSON.stringify(n)}, ${t})`))}else if("display"!=t)if(t.startsWith("attr_")){let n=t.substring(5);if("style"==n||"class"==n||"id"==n)throw new Error(`Incorrect attribute: use '${n}' instead of '${t}'`);m.current_xmlns||(n=y(n)),L(e.template[t],(t=>`helpers.setElementAttribute(${e.name}, ${JSON.stringify(n)}, ${t})`))}else{if("text"!=t)throw new Error(`Unknown element template key: ${t}`);e.template.text instanceof Function?L(e.template.text,(t=>`helpers.setElementText(${e.name}, ${t})`)):e.template.text instanceof i&&m.create.append(`${e.name}.innerHTML = ${JSON.stringify(e.template.text.html)};`),"string"==typeof e.template.text&&m.create.append(`${e.name}.innerText = ${JSON.stringify(e.template.text)};`)}else if(e.template.display instanceof Function)m.addLocal(`${e.name}_prev_display`),L(e.template[t],(t=>`${e.name}_prev_display = helpers.setNodeDisplay(${e.name}, ${t}, ${e.name}_prev_display)`));else if("string"==typeof e.template.display)m.create.append(`${e.name}.style.display = '${e.template.display}';`);else if(!1===e.template.display||null===e.template.display||void 0===e.template.display)m.create.append(`${e.name}.style.display = 'none';`);else if(!0!==e.template.display)throw new Error("display property must be set to string, true, false, or null")}else L(e.template.style,(t=>`${e.name}.setAttribute("style", ${t});`));else L(e.template.class,(t=>`${e.name}.setAttribute("class", ${t});`));else L(e.template.id,(t=>`${e.name}.setAttribute("id", ${t});`));x(e),e.childNodes?.length&&m.create.append(`${e.name}.append(${e.spreadChildDomNodes()});`),m.current_xmlns=t},emit_integrated_node:function(t){let i=[],s=!1;if(t.integrated.nodes)for(let r=0;r<t.integrated.nodes.length;r++){let o=t.integrated.nodes[r];if(!o){i.push(null);continue}o.name="n"+n++;let a=e(o,!1);a.getFunction("bind").isEmpty||(s=!0);let l=`${o.name}_constructor_${r+1}`,d=m.addFunction(l,[]);a.appendTo(d.code),i.push(l)}m.update.append(`${t.name}.update()`),s&&(m.bind.append(`${t.name}.bind()`),m.unbind.append(`${t.name}.unbind()`));let r=-1;t.integrated.data&&(r=o.length,o.push(t.integrated.data)),v(t),m.create.append(`${t.name} = new refs[${o.length}]({`,"  context,",`  data: ${t.integrated.data?`refs[${r}]`:"null"},`,`  nodes: [ ${i.join(", ")} ],`,"});"),o.push(t.template.type),m.setMounted.append(`${t.name}.setMounted(mounted);`),m.destroy.append(`${t.name}?.destroy();`),m.destroy.append(`${t.name} = null;`);for(let e of Object.keys(t.template))if(!N(t,e))throw new Error(`Unknown element template key: ${e}`)},emit_component_node:function(e){v(e),m.create.append(`${e.name} = new refs[${o.length}]();`),o.push(e.template.type);let n=new Set(e.template.type.slots??[]),i="auto"===e.template.update,a=!1;m.setMounted.append(`${e.name}.setMounted(mounted);`),m.destroy.append(`${e.name}?.destroy();`),m.destroy.append(`${e.name} = null;`);for(let l of Object.keys(e.template)){if(N(e,l))continue;if("update"==l)continue;if(n.has(l)){if(void 0===e.template[l])continue;let n=new C(e.template[l],t);$(n),n.isSingleRoot?m.create.append(`${e.name}${b(l)}.content = ${n.name};`):m.create.append(`${e.name}${b(l)}.content = [${n.spreadDomNodes()}];`);continue}let d=typeof e.template[l];if("string"==d||"number"==d||"boolean"==d)m.create.append(`${e.name}${b(l)} = ${JSON.stringify(e.template[l])}`);else if("function"===d){i&&!a&&(a=`${e.name}_mod`,m.update.append(`let ${a} = false;`));let t="p"+r++;m.addLocal(t);let n=o.length;w(),m.update.append(`temp = ${S(n)};`),m.update.append(`if (temp !== ${t})`),i&&(m.update.append("{"),m.update.append(`  ${a} = true;`)),m.update.append(`  ${e.name}${b(l)} = ${t} = temp;`),i&&m.update.append("}"),o.push(e.template[l])}else{let t=e.template[l];t instanceof s&&(t=t.value),m.create.append(`${e.name}${b(l)} = refs[${o.length}];`),o.push(t)}}e.template.update&&("function"==typeof e.template.update?(m.update.append(`if (${S(o.length)})`),m.update.append(`  ${e.name}.update();`),o.push(e.template.update)):i?a&&(m.update.append(`if (${a})`),m.update.append(`  ${e.name}.update();`)):m.update.append(`${e.name}.update();`))}},m=new E;m.create=m.addFunction("create").code,m.bind=m.addFunction("bind").code,m.update=m.addFunction("update").code,m.unbind=m.addFunction("unbind").code,m.setMounted=m.addFunction("setMounted",["mounted"]).code,m.destroy=m.addFunction("destroy").code,c&&(p=m.addFunction("rebind").code);let f=new Map;c&&(a=m,a.code.append("let model = context.model;"),a.code.append("let document = env.document;")),m.code.append("create();"),m.code.append("bind();"),m.code.append("update();"),$(h),m.bind.closure.isEmpty||(m.create.append("bind();"),m.destroy.closure.addProlog().append("unbind();"));let g=[];return h.isSingleRoot&&g.push(`  get rootNode() { return ${h.spreadDomNodes()}; },`),c?(g.push("  context,"),h==l&&d.forEach(((e,t)=>g.push(`  get ${t}() { return ${e}; },`))),m.getFunction("bind").isEmpty?p.append("model = context.model"):(p.append("if (model != context.model)"),p.braced((()=>{p.append("unbind();"),p.append("model = context.model"),p.append("bind();")}))),g.push("  rebind,")):(g.push("  bind,"),g.push("  unbind,")),m.code.append(["return { ","  update,","  destroy,","  setMounted,",`  get rootNodes() { return [ ${h.spreadDomNodes()} ]; },`,`  isSingleRoot: ${h.isSingleRoot},`,...g,"};"]),m;function v(e){e.template.export?a.addLocal(e.name):m.addLocal(e.name)}function w(){m.update.temp_declared||(m.update.temp_declared=!0,m.update.append("let temp;"))}function $(e){e.name="n"+n++,u[`emit_${e.kind}_node`](e)}function x(e){if(e.childNodes)for(let t=0;t<e.childNodes.length;t++)$(e.childNodes[t])}function N(e,t){if(function(e){return"type"==e||"childNodes"==e||"xmlns"==e}(t))return!0;if("export"==t){if("string"!=typeof e.template.export)throw new Error("'export' must be a string");if(d.has(e.template.export))throw new Error(`duplicate export name '${e.template.export}'`);return d.set(e.template.export,e.name),!0}if("bind"==t){if("string"!=typeof e.template.bind)throw new Error("'bind' must be a string");if(f.has(e.template.export))throw new Error(`duplicate bind name '${e.template.bind}'`);return f.set(e.template.bind,!0),m.bind.append(`model${b(e.template.bind)} = ${e.name};`),m.unbind.append(`model${b(e.template.bind)} = null;`),!0}if(t.startsWith("on_")){let n=t.substring(3);if(!(e.template[t]instanceof Function))throw new Error(`event handler for '${t}' is not a function`);e.listenerCount||(e.listenerCount=0),e.listenerCount++;let i=`${e.name}_ev${e.listenerCount}`;return m.addLocal(i),m.create.append(`${i} = helpers.addEventListener(() => model, ${e.name}, ${JSON.stringify(n)}, refs[${o.length}]);`),o.push(e.template[t]),m.destroy.append(`${i}?.();`),m.destroy.append(`${i} = null;`),!0}return"debug_create"==t?("function"==typeof e.template[t]?(m.create.append(`if (${S(o.length)})`),m.create.append("  debugger;"),o.push(e.template[t])):e.template[t]&&m.create.append("debugger;"),!0):"debug_update"==t?("function"==typeof e.template[t]?(m.update.append(`if (${S(o.length)})`),m.update.append("  debugger;"),o.push(e.template[t])):e.template[t]&&m.update.append("debugger;"),!0):"debug_render"==t}function S(e){return`refs[${e}].call(model, model, context)`}function L(e,t){if(e instanceof Function){let n="p"+r++;m.addLocal(n),t(),w(),m.update.append(`temp = ${S(o.length)};`),m.update.append(`if (temp !== ${n})`),m.update.append(`  ${t(n+" = temp")};`),o.push(e)}else m.create.append(t(JSON.stringify(e)))}}(l,!0);return{code:h.toString(),isSingleRoot:l.isSingleRoot,refs:o}}(t,n),o=new Function("env","refs","helpers","context",r.code),a=function(t){return t||(t={}),t.$instanceId=F++,o(e.env,r.refs,S,t??{})};return a.isSingleRoot=r.isSingleRoot,a}class I extends t{constructor(){super(),this.browser=!0,this.document=document,this.compileTemplate=R,this.window=window,this.requestAnimationFrame=window.requestAnimationFrame.bind(window),this.Node=Node}}"undefined"!=typeof document&&n(new I),e.BrowserEnvironment=I,e.CloakedValue=s,e.Component=u,e.DocumentScrollPosition=x,e.EnvironmentBase=t,e.Html=class{static embed(e){return{type:"embed-slot",content:e}}static h(e,t){return{type:`h${e}`,text:t}}static p(e){return{type:"p",text:e}}static a(e,t){return{type:"a",attr_href:e,text:t}}static raw(e){return new i(e)}},e.HtmlString=i,e.ObservableArray=m,e.Router=class{constructor(e,t){this.#O=e,e&&(this.navigate=e.navigate.bind(e),this.replace=e.navigate.bind(e),this.back=e.back.bind(e)),t&&this.register(t)}start(){return this.#O.start(this)}#O;urlMapper;internalize(e){return this.urlMapper?.internalize(e)??new URL(e)}externalize(e){return this.urlMapper?.externalize(e)??new URL(e)}#k=null;get current(){return this.#k}#A=null;get pending(){return this.#A}#i=[];addEventListener(e,t){this.#i.push({event:e,handler:t})}removeEventListener(e,t){let n=this.#i.findIndex((n=>n.event==e&&n.handler==t));n>=0&&this.#i.splice(n,1)}async dispatchEvent(e,t,n,i){for(let s of this.#i)if(s.event==e){let e=s.handler(n,i);if(t&&0==await Promise.resolve(e))return!1}return!0}async load(e,t,n){n=n??{};let i=this.#k;if(this.#k?.url.pathname==e.pathname&&this.#k.url.search==e.search){let e=this.#k.handler.hashChange?.(this.#k,n);n=void 0!==e?e:Object.assign({},this.#k,n)}if(n=Object.assign(n,{current:!1,url:e,pathname:e.pathname,state:t}),this.#A=n,!n.match&&!(n=await this.matchUrl(e,t,n)))return null;try{!0!==await this.tryLoad(n)&&(this.#A=null)}catch(e){throw this.dispatchCancelEvents(i,n),e}return this.#A!=n?(this.dispatchCancelEvents(i,n),null):(this.#A=null,n)}dispatchCancelEvents(e,t){this.#k?.handler.cancelLeave?.(e,t),t.handler.cancelEnter?.(e,t),this.dispatchEvent("cancel",!1,e,t)}async tryLoad(e){let t,n=this.#k;if(n){if(!await this.dispatchEvent("mayLeave",!0,n,e))return;if(e!=this.#A)return;if(t=n.handler.mayLeave?.(n,e),!1===await Promise.resolve(t))return;if(e!=this.#A)return}if(t=e.handler.mayEnter?.(n,e),!1!==await Promise.resolve(t)&&e==this.#A&&await this.dispatchEvent("mayEnter",!0,n,e)&&e==this.#A)return n&&(n.current=!1),e.current=!0,this.#k=e,n&&(this.dispatchEvent("didLeave",!1,n,e),n?.handler.didLeave?.(n,e)),e.handler.didEnter?.(n,e),this.dispatchEvent("didEnter",!1,n,e),!0}async matchUrl(e,t,n){this.#M&&(this.#D.sort(((e,t)=>(e.order??0)-(t.order??0))),this.#M=!1);for(let e of this.#D){if(e.pattern&&(n.match=n.pathname.match(e.pattern),!n.match))continue;let t=await Promise.resolve(e.match(n));if(!0===t||t==n)return n.handler=e,n;if(null===t)return null}return n.handler={},n}#D=[];#M=!1;register(e){Array.isArray(e)||(e=[e]);for(let t of e)"string"==typeof t.pattern&&(t.pattern=new RegExp(f(t.pattern))),this.#D.push(t);this.#M=!0}},e.Style=class{static declare(t){r.push(t),o.push(t),e.env.requestAnimationFrame(l)}static get all(){return r.join("\n")}},e.Template=p,e.Transition=class{constructor(e,t){this.el=e,this.targetClass=t,this.entered=!1,this.pendingTransitions=[],this.detecting=!1,this.transitioning=!1,this.el.addEventListener("transitionend",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitioncancel",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitionrun",this.onTransitionRun.bind(this))}onTransitionEndOrCancel(e){let t=!1;for(let n=0;n<this.pendingTransitions.length;n++){let i=this.pendingTransitions[n];i.target==e.target&&i.propertyName==e.propertyName&&(this.pendingTransitions.splice(n,1),t=!0)}t&&0==this.pendingTransitions.length&&this.onTransitionsFinished()}onTransitionRun(e){this.detecting&&this.pendingTransitions.push({target:e.target,propertyName:e.propertyName})}detectTransitions(){this.transitioning=!0,this.detecting=!0,this.pendingTransitions=[],requestAnimationFrame((()=>requestAnimationFrame((()=>requestAnimationFrame((()=>{this.detecting=!1,0==this.pendingTransitions.length&&this.onTransitionsFinished()}))))))}onTransitionsFinished(){this.el.classList.remove(`${this.targetClass}-start-enter`),this.el.classList.remove(`${this.targetClass}-start-leave`),this.el.classList.remove(`${this.targetClass}-enter`),this.el.classList.remove(`${this.targetClass}-leave`),this.entered?this.el.classList.add(this.targetClass):this.el.classList.remove(this.targetClass),this.transitioning=!1}enter(e){e?!this.transitioning&&this.entered||(this.entered=!0,this.onTransitionsFinished()):this.entered||(this.entered=!0,this.detectTransitions(),this.el.classList.add(this.targetClass,`${this.targetClass}-enter`,`${this.targetClass}-start-enter`),requestAnimationFrame((()=>requestAnimationFrame((()=>{this.el.classList.remove(`${this.targetClass}-start-enter`)})))))}leave(e){e?(this.transitioning||this.entered)&&(this.entered=!1,this.onTransitionsFinished()):this.entered&&(this.entered=!1,this.detectTransitions(),this.el.classList.add(`${this.targetClass}-leave`,`${this.targetClass}-start-leave`),requestAnimationFrame((()=>requestAnimationFrame((()=>{this.el.classList.remove(`${this.targetClass}-start-leave`)})))))}toggle(e){this.entered?this.leave():this.enter()}},e.UrlMapper=class{constructor(e){if(this.options=e,this.options.base&&(!this.options.base.startsWith("/")||!this.options.base.endsWith("/")))throw new Error(`UrlMapper base '${this.options.base}' must start and end with '/'`)}internalize(e){if(this.options.base){if(!e.pathname.startsWith(this.options.base))throw new Error(`Can't internalize url '${e}'`);(e=new URL(e)).pathname=e.pathname.substring(this.options.base.length-1)}if(this.options.hash){let t=e.hash.substring(1);t.startsWith("/")||(t="/"+t),e=new URL(`${e.origin}${t}`)}return e}externalize(e){return this.options.hash&&(e=new URL(`${e.origin}/#${e.pathname}${e.search}${e.hash}`)),this.options.base&&((e=new URL(e)).pathname=this.options.base.slice(0,-1)+e.pathname),e}},e.ViewStateRestoration=class{constructor(t){this.#F=t,e.env.window.history.scrollRestoration&&(e.env.window.history.scrollRestoration="manual");let n=e.env.window.sessionStorage.getItem("codeonly-view-states");n&&(this.#R=JSON.parse(n)),t.addEventListener("mayLeave",((e,t)=>(this.captureViewState(),!0))),t.addEventListener("mayEnter",((e,t)=>{t.viewState=this.#R[t.state.sequence]})),t.addEventListener("didEnter",((t,n)=>{if("push"==n.navMode){for(let e of Object.keys(this.#R))parseInt(e)>n.state.sequence&&delete this.#R[e];this.saveViewStates()}$(e.env,(()=>{c((()=>{n.handler.restoreViewState?n.handler.restoreViewState(n.viewState,n):this.#F.restoreViewState?this.#F.restoreViewState?.(n.viewState,n):x.set(n.viewState);{let e=document.getElementById(n.url.hash.substring(1));e?.scrollIntoView()}}))}))})),e.env.window.addEventListener("beforeunload",(e=>{this.captureViewState()}))}#F;#R={};captureViewState(){let e=this.#F.current;e&&(e.handler.captureViewState?this.#R[e.state.sequence]=e.handler.captureViewState(e):this.#F.captureViewState?this.#R[e.state.sequence]=this.#F.captureViewState?.(e):this.#R[e.state.sequence]=x.get()),this.saveViewStates()}saveViewStates(){e.env.window.sessionStorage.setItem("codeonly-view-states",JSON.stringify(this.#R))}},e.WebHistoryRouterDriver=class{async start(t){this.#F=t,e.env.document.body.addEventListener("click",(t=>{if(t.defaultPrevented)return;let n=t.target.closest("a");if(n){let i=n.getAttribute("href"),s=new URL(i,e.env.window.location);if(s.origin==e.env.window.location.origin){try{s=this.#F.internalize(s)}catch{return}if(this.navigate(s))return t.preventDefault(),!0}}})),e.env.window.addEventListener("popstate",(async t=>{if(this.#I)return void(this.#I=!1);let n=this.#q+1,i=this.#F.internalize(e.env.window.location),s=t.state??{sequence:this.current.state.sequence+1};await this.load(i,s,{navMode:"pop"})||n==this.#q&&(this.#I=!0,e.env.window.history.go(this.current.state.sequence-s.sequence))}));let n=this.#F.internalize(e.env.window.location),i=e.env.window.history.state??{sequence:0},s=await this.load(n,i,{navMode:"start"});return e.env.window.history.replaceState(i,null),s}#q=0;#F;#I=!1;get current(){return this.#F.current}async load(e,t,n){return this.#q++,await this.#F.load(e,t,n)}back(){0==this.current.state.sequence?(this.replace("/"),this.load("/",{sequence:0},{navMode:"replace"})):e.env.window.history.back()}replace(t){"string"==typeof t&&(t=new URL(t,this.#F.internalize(e.env.window.location))),this.current.pathname=t.pathname,this.current.url=t,e.env.window.history.replaceState(this.current.state,"",this.#F.externalize(t))}async navigate(t){"string"==typeof t&&(t=new URL(t,this.#F.internalize(e.env.window.location)));let n=await this.load(t,{sequence:this.current.state.sequence+1},{navMode:"push"});return n?(e.env.window.history.pushState(n.state,"",this.#F.externalize(t)),n):n}},e.areSetsEqual=function(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},e.binarySearch=function(e,t,n){let i=0,s=e.length-1;for(;i<=s;){let r=Math.floor((i+s)/2),o=t(e[r],n);if(0==o)return r;o<0?i=r+1:s=r-1}return-1-i},e.camel_to_dash=y,e.cloak=function(e){return new s(e)},e.compareStrings=function(e,t){return e<t?-1:e>t?1:0},e.compareStringsI=function(e,t){return(e=e.toLowerCase())<(t=t.toLowerCase())?-1:e>t?1:0},e.deepEqual=function e(t,n){if(t===n)return!0;if(void 0===t&&void 0===n)return!0;if(void 0===t||void 0===n)return!1;if(null===t&&null===n)return!0;if(null===t||null===n)return!1;if("object"!=typeof t||"object"!=typeof n)return!1;let i=Object.getOwnPropertyNames(t),s=Object.getOwnPropertyNames(n);if(i.length!=s.length)return!1;for(let s of i){if(!Object.hasOwn(n,s))return!1;if(!e(t[s],n[s]))return!1}return!0},e.html=function(e){return new i(e)},e.htmlEncode=g,e.inplace_filter_array=function(e,t){for(let n=0;n<e.length;n++)t(e[n],n)||(e.splice(n,1),n--)},e.is_constructor=v,e.member=b,e.nextFrame=c,e.postNextFrame=function(e){0==d.length?e():c(e,Number.MAX_SAFE_INTEGER)},e.setEnvironment=n,e.urlPattern=f,e.whenLoaded=$}));
